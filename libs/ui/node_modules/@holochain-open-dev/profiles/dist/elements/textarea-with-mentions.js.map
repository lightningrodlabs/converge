{"version":3,"file":"textarea-with-mentions.js","sourceRoot":"","sources":["../../src/elements/textarea-with-mentions.ts"],"names":[],"mappings":"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","sourcesContent":["import { customElement, property } from \"lit/decorators.js\";\n\nimport { SlTextareaProsemirror } from \"@holochain-open-dev/elements/dist/elements/sl-textarea-prosemirror.js\";\nimport { DnaHash, encodeHashToBase64 } from \"@holochain/client\";\nimport { consume } from \"@lit-labs/context\";\nimport { localized, msg } from \"@lit/localize\";\nimport {\n  getCellIdFromRoleName,\n  joinHrlString,\n  splitHrlString,\n} from \"@holochain-open-dev/utils\";\nimport { Schema, NodeSpec } from \"prosemirror-model\";\nimport { Plugin, PluginKey, Selection, TextSelection } from \"prosemirror-state\";\nimport { baseKeymap } from \"prosemirror-commands\";\nimport { keymap } from \"prosemirror-keymap\";\n\nimport { ProfilesStore } from \"../profiles-store.js\";\nimport { profilesStoreContext } from \"../context.js\";\nimport \"./search-agent-dropdown.js\";\nimport \"./agent-mention.js\";\nimport { SearchAgentDropdown } from \"./search-agent-dropdown.js\";\n\nexport const agentMentionSpec: NodeSpec = {\n  attrs: { agentPubKey: {} },\n  inline: true,\n  group: \"inline\",\n  draggable: true,\n  toDOM: (node) => {\n    console.log(node);\n    return [\n      \"agent-mention\",\n      { \"agent-pub-key\": encodeHashToBase64(node.attrs.agentPubKey) },\n    ];\n  },\n  parseDOM: [{ tag: \"agent-mention\" }],\n};\n\nexport type SearchAgentPluginState =\n  | {\n      dropdownEl: SearchAgentDropdown;\n      mentionCharIndex: number;\n      lastCharIndex: number;\n    }\n  | \"hidden\";\nconst schema = new Schema({\n  nodes: {\n    doc: { content: \"paragraph+\" },\n    paragraph: {\n      content: \"(text|agentMention)*\",\n      toDOM(node) {\n        return [\"p\", 0];\n      },\n    },\n    text: {},\n    agentMention: agentMentionSpec,\n  },\n});\nconst agentType = schema.nodes.agentMention;\n\nexport const pluginKey = new PluginKey(\"search-agent\");\nexport const searchAgentPlugin = new Plugin<SearchAgentPluginState>({\n  key: pluginKey,\n  state: {\n    init() {\n      return \"hidden\";\n    },\n    apply(tr, state) {\n      const newPluginState = tr.getMeta(pluginKey);\n      return newPluginState ? newPluginState : state;\n    },\n  },\n  props: {\n    handleKeyDown(view, event) {\n      const state = this.getState(view.state);\n      if (state && state !== \"hidden\" && event.key === \"ArrowDown\") {\n        state.dropdownEl.dropdown.handleTriggerKeyDown(event);\n      }\n    },\n    handleTextInput(view, from, to, text) {\n      const state = this.getState(view.state);\n      console.log(state);\n\n      if (state && state !== \"hidden\") {\n        setTimeout(() => {\n          state.dropdownEl.searchFilter = view.state.doc.textBetween(\n            state.mentionCharIndex + 1,\n            to + 1\n          );\n          view.dispatch(\n            view.state.tr.setMeta(pluginKey, {\n              ...state,\n              lastCharIndex: to,\n            })\n          );\n        });\n      } else if (text === \"@\") {\n        const { top, left } = view.coordsAtPos(to);\n        const dropdownEl = document.createElement(\n          \"search-agent-dropdown\"\n        ) as SearchAgentDropdown;\n\n        dropdownEl.innerHTML = `<div style=\"position: fixed; height: 24px; top: ${top}px; left: ${left}px\"></div>`;\n        dropdownEl.open = true;\n        dropdownEl.includeMyself = true;\n        view.dom.getRootNode().appendChild(dropdownEl);\n\n        view.dispatch(\n          view.state.tr.setMeta(pluginKey, {\n            dropdownEl,\n            mentionCharIndex: to,\n            lastCharIndex: to,\n          })\n        );\n\n        dropdownEl.addEventListener(\"agent-selected\", (e: any) => {\n          const agentPubKey = e.detail.agentPubKey;\n          const state = this.getState(view.state);\n\n          if (!state || state === \"hidden\") return;\n\n          const tr = view.state.tr;\n\n          tr.replaceRangeWith(\n            state.mentionCharIndex,\n            state.lastCharIndex + 1,\n            agentType.create({\n              agentPubKey,\n            })\n          );\n\n          view.dom.getRootNode().removeChild(dropdownEl);\n          view.dispatch(tr.setMeta(pluginKey, \"hidden\"));\n        });\n\n        dropdownEl.addEventListener(\"sl-hide\", () =>\n          setTimeout(() => {\n            view.dom.getRootNode().removeChild(dropdownEl);\n            view.dispatch(view.state.tr.setMeta(pluginKey, \"hidden\"));\n          }, 10)\n        );\n      }\n    },\n  },\n});\n\n// export class SearchAgentModule {\n//   dropdownEl: SearchAgentDropdown | undefined;\n//   mentionCharIndex: number | undefined;\n//   lastCharIndex: number | undefined;\n\n//   constructor(protected quill: Quill) {\n//     console.log(quill);\n//     quill.container.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n//       if (this.dropdownEl) {\n//         this.dropdownEl!.dropdown.handleTriggerKeyDown(e);\n//       }\n//     });\n//     quill.on(\"text-change\", (delta: any) => {\n//       const insertOneLetter =\n//         delta.ops.length > 0 && \"insert\" in delta.ops[delta.ops.length - 1];\n\n//       if (!insertOneLetter) return;\n\n//       const cursorPosition = \"retain\" in delta.ops[0] ? delta.ops[0].retain : 0;\n\n//       if (this.dropdownEl) {\n//         let searchFilter: string = quill.getText(\n//           this.mentionCharIndex! + 1,\n//           cursorPosition\n//         );\n//         if (searchFilter.endsWith(\"\\n\")) {\n//           searchFilter = searchFilter.slice(0, searchFilter.length - 1);\n//         }\n\n//         this.lastCharIndex = cursorPosition;\n//         this.dropdownEl.searchFilter = searchFilter;\n//       } else if (delta.ops[delta.ops.length - 1].insert === \"@\") {\n//         this.mentionCharIndex = cursorPosition;\n//         this.lastCharIndex = this.mentionCharIndex;\n\n//         const containerPos = quill.container.getBoundingClientRect();\n//         const mentionCharPos = quill.getBounds(this.mentionCharIndex);\n//         const mentionCharPosAbsolute = {\n//           left: containerPos.left + mentionCharPos.left,\n//           top: containerPos.top + mentionCharPos.top,\n//         };\n\n//         this.dropdownEl = document.createElement(\n//           \"search-agent-dropdown\"\n//         ) as SearchAgentDropdown;\n//         this.dropdownEl.innerHTML = `<div style=\"position: fixed; height: 24px; top: ${mentionCharPosAbsolute.top}px; left: ${mentionCharPosAbsolute.left}px\"></div>`;\n//         this.dropdownEl.open = true;\n//         this.dropdownEl.includeMyself = true;\n\n//         this.dropdownEl.addEventListener(\"sl-hide\", () =>\n//           setTimeout(() => this.removeDropdown(), 10)\n//         );\n//         this.dropdownEl.addEventListener(\"agent-selected\", (e) => {\n//           const index = this.mentionCharIndex;\n//           const length = this.lastCharIndex! - this.mentionCharIndex!;\n//           this.removeDropdown();\n//           this.quill.deleteText(index!, length + 1, \"api\");\n//           this.quill.insertEmbed(\n//             index,\n//             \"agent-mention\",\n//             (e as any).detail.agentPubKey,\n//             \"api\"\n//           );\n//           this.quill.insertText(index! + 1, \" \");\n//           setTimeout(() => {\n//             this.quill.focus();\n//             this.quill.setSelection(index! + 1, 0, \"api\");\n//           }, 1000);\n//         });\n\n//         quill.container.appendChild(this.dropdownEl);\n//       }\n//     });\n//   }\n\n//   removeDropdown() {\n//     if (!this.dropdownEl) return;\n//     this.quill.container.removeChild(this.dropdownEl);\n//     this.dropdownEl = undefined;\n//     this.mentionCharIndex = undefined;\n//     this.lastCharIndex = undefined;\n//   }\n\n//   detach() {\n//     this.removeDropdown();\n//   }\n// }\n\n// Quill.register(\"modules/search-agent\", SearchAgentModule);\n\n@localized()\n@customElement(\"textarea-with-mentions\")\nexport class TextareaWithMentions extends SlTextareaProsemirror {\n  /**\n   * Profiles store for this element, not required if you embed this element inside a <profiles-context>\n   */\n  @consume({ context: profilesStoreContext, subscribe: true })\n  @property()\n  store!: ProfilesStore;\n\n  dnaHash!: DnaHash;\n\n  async firstUpdated() {\n    super.firstUpdated();\n    const appInfo = await this.store.client.client.appInfo();\n\n    const cellId = getCellIdFromRoleName(this.store.client.roleName, appInfo);\n    this.dnaHash = cellId[0];\n  }\n\n  @property()\n  helpText: string = msg(\"Press '@' to mention an agent.\");\n\n  get value() {\n    if (!this.input?.quill) return \"\";\n    const contents = this.input.quill.getContents();\n\n    const array = contents.ops.map((delta: any) => {\n      if (typeof delta.insert === \"string\") {\n        return delta.insert;\n      } else {\n        return [this.dnaHash, delta.insert[\"agent-mention\"]];\n      }\n    });\n\n    const text = joinHrlString(array);\n\n    return text.slice(0, text.length - 1); // Slice to remove the newline\n  }\n\n  set value(v: string) {\n    if (!this.input?.quill) return;\n    const array = splitHrlString(v);\n\n    const ops = array.map((hrlOrString) => {\n      if (typeof hrlOrString === \"string\") {\n        return {\n          insert: hrlOrString,\n        };\n      } else {\n        return {\n          insert: {\n            \"agent-mention\": hrlOrString[1],\n          },\n        };\n      }\n    });\n    this.input.quill.setContents(ops);\n  }\n\n  editorStateConfig() {\n    return {\n      schema,\n      plugins: [keymap(baseKeymap), searchAgentPlugin],\n    };\n  }\n}\n"]}