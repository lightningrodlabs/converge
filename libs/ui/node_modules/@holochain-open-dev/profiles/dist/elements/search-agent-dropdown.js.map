{"version":3,"file":"search-agent-dropdown.js","sourceRoot":"","sources":["../../src/elements/search-agent-dropdown.ts"],"names":[],"mappings":"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","sourcesContent":["import { customElement, property, state, query } from \"lit/decorators.js\";\nimport { ifDefined } from \"lit/directives/if-defined.js\";\nimport { css, html, LitElement } from \"lit\";\nimport { consume } from \"@lit-labs/context\";\nimport { localized, msg } from \"@lit/localize\";\nimport {\n  AgentPubKey,\n  decodeHashFromBase64,\n  encodeHashToBase64,\n} from \"@holochain/client\";\nimport { StoreSubscriber, toPromise } from \"@holochain-open-dev/stores\";\n\nimport \"@holochain-open-dev/elements/dist/elements/display-error.js\";\nimport \"@shoelace-style/shoelace/dist/components/skeleton/skeleton.js\";\nimport \"@shoelace-style/shoelace/dist/components/menu/menu.js\";\nimport \"@shoelace-style/shoelace/dist/components/menu-item/menu-item.js\";\nimport \"@shoelace-style/shoelace/dist/components/dropdown/dropdown.js\";\nimport \"@shoelace-style/shoelace/dist/components/input/input.js\";\nimport SlDropdown from \"@shoelace-style/shoelace/dist/components/dropdown/dropdown.js\";\n\nimport \"./agent-avatar.js\";\nimport \"./profile-list-item-skeleton.js\";\n\nimport { ProfilesStore } from \"../profiles-store.js\";\nimport { profilesStoreContext } from \"../context.js\";\nimport { sharedStyles } from \"@holochain-open-dev/elements\";\n\n/**\n * @element search-agent-dropdown\n * @fires agent-selected - Fired when the user selects some agent. Detail will have this shape: { agentPubKey: HoloHash }\n */\n@localized()\n@customElement(\"search-agent-dropdown\")\nexport class SearchAgentDropdown extends LitElement {\n  /** Public attributes */\n\n  @property()\n  searchFilter: string | undefined;\n\n  @property()\n  open: boolean | undefined;\n\n  /**\n   * Whether to include my own agent as a possible agent to select.\n   * @attr include-myself\n   */\n  @property({ type: Boolean, attribute: \"include-myself\" })\n  includeMyself = false;\n\n  /**\n   * Profiles store for this element, not required if you embed this element inside a <profiles-context>\n   */\n  @consume({ context: profilesStoreContext, subscribe: true })\n  @property()\n  store!: ProfilesStore;\n\n  /**\n   * @internal\n   */\n  private _searchProfiles = new StoreSubscriber(\n    this,\n    () =>\n      this.searchFilter && this.searchFilter.length >= 3\n        ? this.store.searchProfiles(this.searchFilter)\n        : undefined,\n    () => [this.searchFilter]\n  );\n\n  /**\n   * @internal\n   */\n  @query(\"#dropdown\")\n  public dropdown!: SlDropdown;\n\n  async onUsernameSelected(agentPubKey: AgentPubKey) {\n    const profile = await toPromise(this.store.profiles.get(agentPubKey));\n    this.dispatchEvent(\n      new CustomEvent(\"agent-selected\", {\n        detail: {\n          agentPubKey,\n          profile,\n        },\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  renderAgentList() {\n    if (this._searchProfiles.value === undefined)\n      return html`<sl-menu-item disabled\n        >${msg(\"Enter at least 3 chars to search...\")}</sl-menu-item\n      >`;\n    switch (this._searchProfiles.value.status) {\n      case \"pending\":\n        return Array(3).map(\n          () => html`\n            <sl-menu-item>\n              <sl-skeleton\n                effect=\"sheen\"\n                slot=\"prefix\"\n                style=\"height: 32px; width: 32px; border-radius: 50%; margin: 8px\"\n              ></sl-skeleton>\n              <sl-skeleton\n                effect=\"sheen\"\n                style=\"width: 100px; margin: 8px; border-radius: 12px\"\n              ></sl-skeleton>\n            </sl-menu-item>\n          `\n        );\n      case \"error\":\n        return html`\n          <display-error\n            style=\"flex: 1; display:flex\"\n            tooltip\n            .headline=${msg(\"Error searching agents\")}\n            .error=${this._searchProfiles.value.error}\n          ></display-error>\n        `;\n      case \"complete\": {\n        let agents = Array.from(this._searchProfiles.value.value.entries());\n\n        if (!this.includeMyself) {\n          agents = agents.filter(\n            ([pubkey, _profile]) =>\n              pubkey.toString() !== this.store.client.client.myPubKey.toString()\n          );\n        }\n\n        if (agents.length === 0)\n          return html`<sl-menu-item disabled>\n            ${msg(\"No agents match the filter\")}\n          </sl-menu-item>`;\n\n        return html`\n          ${agents.map(\n            ([pubkey, profile]) => html`\n              <sl-menu-item .value=${encodeHashToBase64(pubkey)}>\n                <agent-avatar\n                  slot=\"prefix\"\n                  .agentPubKey=${pubkey}\n                  style=\"margin-right: 16px\"\n                ></agent-avatar>\n                ${profile.nickname}\n              </sl-menu-item>\n            `\n          )}\n        `;\n      }\n    }\n  }\n\n  render() {\n    return html`\n      <sl-dropdown id=\"dropdown\" style=\"flex: 1\" .open=${ifDefined(this.open)}>\n        <slot slot=\"trigger\"></slot>\n        <sl-menu\n          @sl-select=${(e: CustomEvent) => {\n            this.onUsernameSelected(decodeHashFromBase64(e.detail.item.value));\n          }}\n        >\n          ${this.renderAgentList()}\n        </sl-menu>\n      </sl-dropdown>\n    `;\n  }\n\n  static get styles() {\n    return [\n      sharedStyles,\n      css`\n        :host {\n          display: flex;\n        }\n      `,\n    ];\n  }\n}\n"]}