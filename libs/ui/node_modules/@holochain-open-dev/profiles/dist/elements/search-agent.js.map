{"version":3,"file":"search-agent.js","sourceRoot":"","sources":["../../src/elements/search-agent.ts"],"names":[],"mappings":"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","sourcesContent":["import { customElement, property, state, query } from \"lit/decorators.js\";\nimport { css, html, LitElement } from \"lit\";\nimport { consume } from \"@lit-labs/context\";\nimport { localized, msg } from \"@lit/localize\";\nimport { AgentPubKey } from \"@holochain/client\";\nimport {\n  FormField,\n  FormFieldController,\n  hashProperty,\n  sharedStyles,\n} from \"@holochain-open-dev/elements\";\n\nimport \"@holochain-open-dev/elements/dist/elements/display-error.js\";\nimport \"@shoelace-style/shoelace/dist/components/skeleton/skeleton.js\";\nimport \"@shoelace-style/shoelace/dist/components/menu/menu.js\";\nimport \"@shoelace-style/shoelace/dist/components/menu-item/menu-item.js\";\nimport \"@shoelace-style/shoelace/dist/components/dropdown/dropdown.js\";\nimport \"@shoelace-style/shoelace/dist/components/input/input.js\";\nimport SlInput from \"@shoelace-style/shoelace/dist/components/input/input\";\n\nimport \"./agent-avatar.js\";\nimport \"./profile-list-item-skeleton.js\";\nimport \"./search-agent-dropdown.js\";\n\nimport { Profile } from \"../types.js\";\nimport { ProfilesStore } from \"../profiles-store.js\";\nimport { profilesStoreContext } from \"../context.js\";\n\n/**\n * @element search-agent\n * @fires agent-selected - Fired when the user selects some agent. Detail will have this shape: { agentPubKey: HoloHash }\n */\n@localized()\n@customElement(\"search-agent\")\nexport class SearchAgent extends LitElement implements FormField {\n  /** Form field properties */\n\n  /**\n   * The name of the field if this element is used inside a form\n   * Required only if the element is used inside a form\n   */\n  @property()\n  name!: string;\n\n  /**\n   * The default value of the field if this element is used inside a form\n   */\n  @property(hashProperty(\"default-value\"))\n  defaultValue: AgentPubKey | undefined;\n\n  /**\n   * Whether this field is required if this element is used inside a form\n   */\n  @property()\n  required = false;\n\n  /**\n   * Whether this field is disabled if this element is used inside a form\n   */\n  @property()\n  disabled = false;\n\n  /**\n   * @internal\n   */\n  @state()\n  value!: AgentPubKey | undefined;\n\n  /** Public attributes */\n\n  /**\n   * Whether to clear the field when an agent is selected.\n   * @attr clear-on-select\n   */\n  @property({ type: Boolean, attribute: \"clear-on-select\" })\n  clearOnSelect = false;\n\n  /**\n   * Whether to include my own agent as a possible agent to select.\n   * @attr include-myself\n   */\n  @property({ type: Boolean, attribute: \"include-myself\" })\n  includeMyself = false;\n\n  /**\n   * Label for the agent searching field.\n   * @attr field-label\n   */\n  @property({ type: String, attribute: \"field-label\" })\n  fieldLabel!: string;\n\n  /**\n   * Profiles store for this element, not required if you embed this element inside a <profiles-context>\n   */\n  @consume({ context: profilesStoreContext, subscribe: true })\n  @property()\n  store!: ProfilesStore;\n\n  /**\n   * @internal\n   */\n  _controller = new FormFieldController(this);\n\n  reportValidity() {\n    const invalid = this.required !== false && this.value === undefined;\n\n    if (invalid) {\n      this._textField.setCustomValidity(`This field is required`);\n      this._textField.reportValidity();\n    }\n\n    return !invalid;\n  }\n\n  async reset() {\n    this.value = this.defaultValue;\n    if (this.defaultValue) {\n      const profile = await this.store.client.getAgentProfile(\n        this.defaultValue\n      );\n      this._textField.value = profile?.nickname || \"\";\n    } else {\n      this._textField.value = \"\";\n    }\n  }\n\n  /**\n   * @internal\n   */\n  @query(\"#textfield\")\n  private _textField!: SlInput;\n\n  @state()\n  searchFilter = \"\";\n\n  onUsernameSelected(agentPubKey: AgentPubKey, profile: Profile) {\n    this.value = agentPubKey;\n\n    // If the consumer says so, clear the field\n    if (this.clearOnSelect) {\n      this._textField.value = \"\";\n    } else {\n      this._textField.value = profile.nickname;\n    }\n    this.searchFilter = \"\";\n  }\n\n  /**\n   * @internal\n   */\n  get _label() {\n    let l = this.fieldLabel ? this.fieldLabel : msg(\"Search Agent\");\n\n    if (this.required !== false) l = `${l} *`;\n\n    return l;\n  }\n\n  render() {\n    return html`\n      <div style=\"flex: 1; display: flex;\">\n        <search-agent-dropdown\n          id=\"dropdown\"\n          .open=${this.searchFilter.length >= 3}\n          style=\"flex: 1\"\n          .includeMyself=${this.includeMyself}\n          .searchFilter=${this.searchFilter}\n          @agent-selected=${(e: CustomEvent) =>\n            this.onUsernameSelected(e.detail.agentPubKey, e.detail.profile)}\n        >\n          <sl-input\n            id=\"textfield\"\n            .label=${this._label}\n            .placeholder=${msg(\"At least 3 chars...\")}\n            @input=${(e: CustomEvent) => {\n              this.searchFilter = (e.target as SlInput).value;\n            }}\n          ></sl-input>\n        </search-agent-dropdown>\n      </div>\n    `;\n  }\n\n  static get styles() {\n    return [\n      sharedStyles,\n      css`\n        :host {\n          display: flex;\n        }\n      `,\n    ];\n  }\n}\n"]}